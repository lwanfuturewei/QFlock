/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the "License"); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.github.qflock.extensions.rules

import org.apache.spark.sql.catalyst.catalog.{CatalogStatistics, CatalogTable}
import org.apache.spark.sql.catalyst.expressions.AttributeReference
import org.apache.spark.sql.catalyst.plans.logical.Statistics
import org.apache.spark.sql.catalyst.util.truncatedString
import org.apache.spark.sql.execution.datasources.LogicalRelation
import org.apache.spark.sql.hive.extension.ExtHiveUtils
import org.apache.spark.sql.sources.BaseRelation

class QflockLogicalRelation(override val relation: BaseRelation,
                            override val output: Seq[AttributeReference],
                            override val catalogTable: Option[CatalogTable],
                            override val isStreaming: Boolean)
                           (val rowCount: Option[BigInt],
                            val previousSizeInBytes: BigInt,
                            val estimate: Option[Boolean] = Some(false))
  extends LogicalRelation(relation, output, catalogTable, isStreaming) {
  def getArgs: Option[(BaseRelation, Seq[AttributeReference], Option[CatalogTable], Boolean)] =
  Some(relation, output, catalogTable, isStreaming)
  var tableName = catalogTable.get.identifier.table
  var dbName = catalogTable.get.identifier.database.getOrElse("")
  def isEstimate: Boolean = estimate.getOrElse(false)
  override protected final def otherCopyArgs: Seq[AnyRef] = {
    rowCount :: previousSizeInBytes :: estimate :: Nil
  }
  private val sparkSizeInBytes = stats.sizeInBytes.longValue()
  val sizeInBytes = {
    val rows = rowCount.getOrElse(BigInt(1)).longValue()
    output.foldLeft(0)((x, y) => (x +
      (QflockLogicalRelation.getColSize(dbName, tableName, y.name) * rows).asInstanceOf[Int]))
  }
  private val previousBytes = previousSizeInBytes.longValue()
  override def computeStats(): Statistics = {
    catalogTable
      .flatMap(_.stats.map(x =>
        new CatalogStatistics(x.sizeInBytes,
                              rowCount,
                              x.colStats)
        .toPlanStats(output, true)))
      .getOrElse(Statistics(sizeInBytes = relation.sizeInBytes))
  }
  override def simpleString(maxFields: Int): String =
    s"QflockLogicalRelation prevSize:${previousSizeInBytes} " +
      s"size:${sizeInBytes} " +
      s" ${catalogTable.map(_.identifier.unquotedString).getOrElse("")}" +
      s"[${truncatedString(output, ",", maxFields)}] $relation"
}

object QflockLogicalRelation {
  def unapply(relation: QflockLogicalRelation):
  Option[(BaseRelation, Seq[AttributeReference], Option[CatalogTable], Boolean)] = {
    relation.getArgs
  }
  def getColSize(dbName: String, tableName: String, colName: String): Double = {
    val tbl = ExtHiveUtils.getTable(dbName, tableName)
    colsSizeMap(colName)
  }
  val colsSizeMap = Map[String, Double]("cc_call_center_sk" -> (70.0 / 6.0),
    "cc_call_center_id" -> (84.0 / 6.0),
    "cc_rec_start_date" -> (98.0 / 6.0),
    "cc_rec_end_date" -> (67.0 / 6.0),
    "cc_closed_date_sk" -> (31.0 / 6.0),
    "cc_open_date_sk" -> (79.0 / 6.0),
    "cc_name" -> (100.0 / 6.0),
    "cc_class" -> (74.0 / 6.0),
    "cc_employees" -> (71.0 / 6.0),
    "cc_sq_ft" -> (90.0 / 6.0),
    "cc_hours" -> (78.0 / 6.0),
    "cc_manager" -> (139.0 / 6.0),
    "cc_mkt_id" -> (77.0 / 6.0),
    "cc_mkt_class" -> (205.0 / 6.0),
    "cc_mkt_desc" -> (218.0 / 6.0),
    "cc_market_manager" -> (135.0 / 6.0),
    "cc_division" -> (77.0 / 6.0),
    "cc_division_name" -> (79.0 / 6.0),
    "cc_company" -> (63.0 / 6.0),
    "cc_company_name" -> (95.0 / 6.0),
    "cc_street_number" -> (77.0 / 6.0),
    "cc_street_name" -> (99.0 / 6.0),
    "cc_street_type" -> (79.0 / 6.0),
    "cc_suite_number" -> (87.0 / 6.0),
    "cc_city" -> (77.0 / 6.0),
    "cc_county" -> (75.0 / 6.0),
    "cc_state" -> (60.0 / 6.0),
    "cc_zip" -> (73.0 / 6.0),
    "cc_country" -> (71.0 / 6.0),
    "cc_gmt_offset" -> (62.0 / 6.0),
    "cc_tax_percentage" -> (83.0 / 6.0),
    "cp_catalog_page_sk" -> (47703.0 / 11718.0),
    "cp_catalog_page_id" -> (58738.0 / 11718.0),
    "cp_start_date_sk" -> (1198.0 / 11718.0),
    "cp_end_date_sk" -> (1187.0 / 11718.0),
    "cp_department" -> (486.0 / 11718.0),
    "cp_catalog_number" -> (1219.0 / 11718.0),
    "cp_catalog_page_number" -> (2903.0 / 11718.0),
    "cp_description" -> (584021.0 / 11718.0),
    "cp_type" -> (502.0 / 11718.0),
    "cr_returned_date_sk" -> (199899.0 / 143974.0),
    "cr_returned_time_sk" -> (632777.0 / 143974.0),
    "cr_item_sk" -> (325159.0 / 143974.0),
    "cr_refunded_customer_sk" -> (554812.0 / 143974.0),
    "cr_refunded_cdemo_sk" -> (740997.0 / 143974.0),
    "cr_refunded_hdemo_sk" -> (266047.0 / 143974.0),
    "cr_refunded_addr_sk" -> (459091.0 / 143974.0),
    "cr_returning_customer_sk" -> (640142.0 / 143974.0),
    "cr_returning_cdemo_sk" -> (707921.0 / 143974.0),
    "cr_returning_hdemo_sk" -> (265953.0 / 143974.0),
    "cr_returning_addr_sk" -> (602915.0 / 143974.0),
    "cr_call_center_sk" -> (50909.0 / 143974.0),
    "cr_catalog_page_sk" -> (251154.0 / 143974.0),
    "cr_ship_mode_sk" -> (96101.0 / 143974.0),
    "cr_warehouse_sk" -> (60797.0 / 143974.0),
    "cr_reason_sk" -> (113844.0 / 143974.0),
    "cr_order_number" -> (667522.0 / 143974.0),
    "cr_return_quantity" -> (131751.0 / 143974.0),
    "cr_return_amount" -> (717808.0 / 143974.0),
    "cr_return_tax" -> (391774.0 / 143974.0),
    "cr_return_amt_inc_tax" -> (733866.0 / 143974.0),
    "cr_fee" -> (301529.0 / 143974.0),
    "cr_return_ship_cost" -> (699169.0 / 143974.0),
    "cr_refunded_cash" -> (711244.0 / 143974.0),
    "cr_reversed_charge" -> (552633.0 / 143974.0),
    "cr_store_credit" -> (551555.0 / 143974.0),
    "cr_net_loss" -> (714327.0 / 143974.0),
    "cs_sold_date_sk" -> (43828.0 / 1440839.0),
    "cs_sold_time_sk" -> (1337719.0 / 1440839.0),
    "cs_ship_date_sk" -> (1885012.0 / 1440839.0),
    "cs_bill_customer_sk" -> (1593327.0 / 1440839.0),
    "cs_bill_cdemo_sk" -> (2036827.0 / 1440839.0),
    "cs_bill_hdemo_sk" -> (1286155.0 / 1440839.0),
    "cs_bill_addr_sk" -> (1212724.0 / 1440839.0),
    "cs_ship_customer_sk" -> (1595772.0 / 1440839.0),
    "cs_ship_cdemo_sk" -> (2032453.0 / 1440839.0),
    "cs_ship_hdemo_sk" -> (1286108.0 / 1440839.0),
    "cs_ship_addr_sk" -> (1218045.0 / 1440839.0),
    "cs_call_center_sk" -> (244524.0 / 1440839.0),
    "cs_catalog_page_sk" -> (2209659.0 / 1440839.0),
    "cs_ship_mode_sk" -> (928409.0 / 1440839.0),
    "cs_warehouse_sk" -> (569680.0 / 1440839.0),
    "cs_item_sk" -> (2635128.0 / 1440839.0),
    "cs_promo_sk" -> (1646829.0 / 1440839.0),
    "cs_order_number" -> (1851412.0 / 1440839.0),
    "cs_quantity" -> (1287434.0 / 1440839.0),
    "cs_wholesale_cost" -> (2588030.0 / 1440839.0),
    "cs_list_price" -> (2856964.0 / 1440839.0),
    "cs_sales_price" -> (2835294.0 / 1440839.0),
    "cs_ext_discount_amt" -> (7472668.0 / 1440839.0),
    "cs_ext_sales_price" -> (7470772.0 / 1440839.0),
    "cs_ext_wholesale_cost" -> (7482044.0 / 1440839.0),
    "cs_ext_list_price" -> (7782791.0 / 1440839.0),
    "cs_ext_tax" -> (3395800.0 / 1440839.0),
    "cs_coupon_amt" -> (2303534.0 / 1440839.0),
    "cs_ext_ship_cost" -> (7200144.0 / 1440839.0),
    "cs_net_paid" -> (7460582.0 / 1440839.0),
    "cs_net_paid_inc_tax" -> (7644995.0 / 1440839.0),
    "cs_net_paid_inc_ship" -> (7669274.0 / 1440839.0),
    "cs_net_paid_inc_ship_tax" -> (7866368.0 / 1440839.0),
    "cs_net_profit" -> (7447278.0 / 1440839.0),
    "c_customer_sk" -> (401227.0 / 100000.0),
    "c_customer_id" -> (497842.0 / 100000.0),
    "c_current_cdemo_sk" -> (487548.0 / 100000.0),
    "c_current_hdemo_sk" -> (193365.0 / 100000.0),
    "c_current_addr_sk" -> (422342.0 / 100000.0),
    "c_first_shipto_date_sk" -> (167045.0 / 100000.0),
    "c_first_sales_date_sk" -> (167092.0 / 100000.0),
    "c_salutation" -> (43930.0 / 100000.0),
    "c_first_name" -> (181512.0 / 100000.0),
    "c_last_name" -> (197339.0 / 100000.0),
    "c_preferred_cust_flag" -> (19931.0 / 100000.0),
    "c_birth_day" -> (68124.0 / 100000.0),
    "c_birth_month" -> (56069.0 / 100000.0),
    "c_birth_year" -> (92483.0 / 100000.0),
    "c_birth_country" -> (106405.0 / 100000.0),
    "c_login" -> (175.0 / 100000.0),
    "c_email_address" -> (2332447.0 / 100000.0),
    "c_last_review_date" -> (117669.0 / 100000.0),
    "ca_address_sk" -> (201009.0 / 50000.0),
    "ca_address_id" -> (248962.0 / 50000.0),
    "ca_street_number" -> (68135.0 / 50000.0),
    "ca_street_name" -> (127108.0 / 50000.0),
    "ca_street_type" -> (34086.0 / 50000.0),
    "ca_suite_number" -> (46403.0 / 50000.0),
    "ca_city" -> (69895.0 / 50000.0),
    "ca_county" -> (87936.0 / 50000.0),
    "ca_state" -> (40251.0 / 50000.0),
    "ca_zip" -> (94155.0 / 50000.0),
    "ca_country" -> (3596.0 / 50000.0),
    "ca_gmt_offset" -> (21838.0 / 50000.0),
    "ca_location_type" -> (15747.0 / 50000.0),
    "cd_demo_sk" -> (7692762.0 / 1920800.0),
    "cd_gender" -> (15724.0 / 1920800.0),
    "cd_marital_status" -> (41778.0 / 1920800.0),
    "cd_education_status" -> (23381.0 / 1920800.0),
    "cd_purchase_estimate" -> (13986.0 / 1920800.0),
    "cd_credit_rating" -> (5518.0 / 1920800.0),
    "cd_dep_count" -> (4823.0 / 1920800.0),
    "cd_dep_employed_count" -> (4078.0 / 1920800.0),
    "cd_dep_college_count" -> (3940.0 / 1920800.0),
    "d_date_sk" -> (292556.0 / 73049.0),
    "d_date_id" -> (363242.0 / 73049.0),
    "d_date" -> (280382.0 / 73049.0),
    "d_month_seq" -> (17033.0 / 73049.0),
    "d_week_seq" -> (121418.0 / 73049.0),
    "d_quarter_seq" -> (6392.0 / 73049.0),
    "d_year" -> (1618.0 / 73049.0),
    "d_dow" -> (1633.0 / 73049.0),
    "d_moy" -> (605.0 / 73049.0),
    "d_dom" -> (4493.0 / 73049.0),
    "d_qoy" -> (410.0 / 73049.0),
    "d_fy_year" -> (1618.0 / 73049.0),
    "d_fy_quarter_seq" -> (6392.0 / 73049.0),
    "d_fy_week_seq" -> (121418.0 / 73049.0),
    "d_day_name" -> (1667.0 / 73049.0),
    "d_quarter_name" -> (6341.0 / 73049.0),
    "d_holiday" -> (361.0 / 73049.0),
    "d_weekend" -> (678.0 / 73049.0),
    "d_following_holiday" -> (365.0 / 73049.0),
    "d_first_dom" -> (17325.0 / 73049.0),
    "d_last_dom" -> (17327.0 / 73049.0),
    "d_same_day_ly" -> (292363.0 / 73049.0),
    "d_same_day_lq" -> (291407.0 / 73049.0),
    "d_current_day" -> (182.0 / 73049.0),
    "d_current_week" -> (182.0 / 73049.0),
    "d_current_month" -> (194.0 / 73049.0),
    "d_current_quarter" -> (196.0 / 73049.0),
    "d_current_year" -> (196.0 / 73049.0),
    "hd_demo_sk" -> (29616.0 / 7200.0),
    "hd_income_band_sk" -> (416.0 / 7200.0),
    "hd_buy_potential" -> (172.0 / 7200.0),
    "hd_dep_count" -> (152.0 / 7200.0),
    "hd_vehicle_count" -> (109.0 / 7200.0),
    "ib_income_band_sk" -> (171.0 / 20.0),
    "ib_lower_bound" -> (141.0 / 20.0),
    "ib_upper_bound" -> (145.0 / 20.0),
    "inv_date_sk" -> (25222.0 / 11745000.0),
    "inv_item_sk" -> (20577715.0 / 11745000.0),
    "inv_warehouse_sk" -> (27416.0 / 11745000.0),
    "inv_quantity_on_hand" -> (15078918.0 / 11745000.0),
    "i_item_sk" -> (72844.0 / 18000.0),
    "i_item_id" -> (76175.0 / 18000.0),
    "i_rec_start_date" -> (738.0 / 18000.0),
    "i_rec_end_date" -> (324.0 / 18000.0),
    "i_item_desc" -> (931111.0 / 18000.0),
    "i_current_price" -> (39009.0 / 18000.0),
    "i_wholesale_cost" -> (33764.0 / 18000.0),
    "i_brand_id" -> (26686.0 / 18000.0),
    "i_brand" -> (27557.0 / 18000.0),
    "i_class_id" -> (9304.0 / 18000.0),
    "i_class" -> (16969.0 / 18000.0),
    "i_category_id" -> (9335.0 / 18000.0),
    "i_category" -> (9381.0 / 18000.0),
    "i_manufact_id" -> (26732.0 / 18000.0),
    "i_manufact" -> (29158.0 / 18000.0),
    "i_size" -> (7017.0 / 18000.0),
    "i_formulation" -> (269177.0 / 18000.0),
    "i_color" -> (16757.0 / 18000.0),
    "i_units" -> (11675.0 / 18000.0),
    "i_container" -> (280.0 / 18000.0),
    "i_manager_id" -> (16376.0 / 18000.0),
    "i_product_name" -> (123686.0 / 18000.0),
    "p_promo_sk" -> (1999.0 / 300.0),
    "p_promo_id" -> (1609.0 / 300.0),
    "p_start_date_sk" -> (1377.0 / 300.0),
    "p_end_date_sk" -> (1402.0 / 300.0),
    "p_item_sk" -> (1308.0 / 300.0),
    "p_cost" -> (72.0 / 300.0),
    "p_response_target" -> (65.0 / 300.0),
    "p_promo_name" -> (169.0 / 300.0),
    "p_channel_dmail" -> (114.0 / 300.0),
    "p_channel_email" -> (67.0 / 300.0),
    "p_channel_catalog" -> (74.0 / 300.0),
    "p_channel_tv" -> (72.0 / 300.0),
    "p_channel_radio" -> (66.0 / 300.0),
    "p_channel_press" -> (70.0 / 300.0),
    "p_channel_event" -> (66.0 / 300.0),
    "p_channel_demo" -> (67.0 / 300.0),
    "p_channel_details" -> (9510.0 / 300.0),
    "p_purpose" -> (81.0 / 300.0),
    "p_discount_active" -> (67.0 / 300.0),
    "r_reason_sk" -> (263.0 / 35.0),
    "r_reason_id" -> (226.0 / 35.0),
    "r_reason_desc" -> (526.0 / 35.0),
    "sm_ship_mode_sk" -> (171.0 / 20.0),
    "sm_ship_mode_id" -> (149.0 / 20.0),
    "sm_type" -> (133.0 / 20.0),
    "sm_code" -> (93.0 / 20.0),
    "sm_carrier" -> (236.0 / 20.0),
    "sm_contract" -> (320.0 / 20.0),
    "s_store_sk" -> (114.0 / 12.0),
    "s_store_id" -> (103.0 / 12.0),
    "s_rec_start_date" -> (104.0 / 12.0),
    "s_rec_end_date" -> (95.0 / 12.0),
    "s_closed_date_sk" -> (63.0 / 12.0),
    "s_store_name" -> (124.0 / 12.0),
    "s_number_employees" -> (111.0 / 12.0),
    "s_floor_space" -> (129.0 / 12.0),
    "s_hours" -> (78.0 / 12.0),
    "s_manager" -> (241.0 / 12.0),
    "s_market_id" -> (93.0 / 12.0),
    "s_geography_class" -> (65.0 / 12.0),
    "s_market_desc" -> (601.0 / 12.0),
    "s_market_manager" -> (247.0 / 12.0),
    "s_division_id" -> (62.0 / 12.0),
    "s_division_name" -> (65.0 / 12.0),
    "s_company_id" -> (62.0 / 12.0),
    "s_company_name" -> (65.0 / 12.0),
    "s_street_number" -> (104.0 / 12.0),
    "s_street_name" -> (165.0 / 12.0),
    "s_street_type" -> (117.0 / 12.0),
    "s_suite_number" -> (103.0 / 12.0),
    "s_city" -> (78.0 / 12.0),
    "s_county" -> (75.0 / 12.0),
    "s_state" -> (60.0 / 12.0),
    "s_zip" -> (74.0 / 12.0),
    "s_country" -> (71.0 / 12.0),
    "s_gmt_offset" -> (62.0 / 12.0),
    "s_tax_precentage" -> (99.0 / 12.0),
    "sr_returned_date_sk" -> (412479.0 / 287777.0),
    "sr_return_time_sk" -> (675004.0 / 287777.0),
    "sr_item_sk" -> (608425.0 / 287777.0),
    "sr_customer_sk" -> (980853.0 / 287777.0),
    "sr_cdemo_sk" -> (1402448.0 / 287777.0),
    "sr_hdemo_sk" -> (502398.0 / 287777.0),
    "sr_addr_sk" -> (1194201.0 / 287777.0),
    "sr_store_sk" -> (126521.0 / 287777.0),
    "sr_reason_sk" -> (230765.0 / 287777.0),
    "sr_ticket_number" -> (1158290.0 / 287777.0),
    "sr_return_quantity" -> (265874.0 / 287777.0),
    "sr_return_amt" -> (1405781.0 / 287777.0),
    "sr_return_tax" -> (672877.0 / 287777.0),
    "sr_return_amt_inc_tax" -> (1432677.0 / 287777.0),
    "sr_fee" -> (554859.0 / 287777.0),
    "sr_return_ship_cost" -> (990963.0 / 287777.0),
    "sr_refunded_cash" -> (1394476.0 / 287777.0),
    "sr_reversed_charge" -> (939013.0 / 287777.0),
    "sr_store_credit" -> (931591.0 / 287777.0),
    "sr_net_loss" -> (1397538.0 / 287777.0),
    "ss_sold_date_sk" -> (1051898.0 / 2790100.0),
    "ss_sold_time_sk" -> (1280442.0 / 2790100.0),
    "ss_item_sk" -> (5310826.0 / 2790100.0),
    "ss_customer_sk" -> (1631283.0 / 2790100.0),
    "ss_cdemo_sk" -> (2487456.0 / 2790100.0),
    "ss_hdemo_sk" -> (1095650.0 / 2790100.0),
    "ss_addr_sk" -> (1301262.0 / 2790100.0),
    "ss_store_sk" -> (640507.0 / 2790100.0),
    "ss_promo_sk" -> (3251026.0 / 2790100.0),
    "ss_ticket_number" -> (1930703.0 / 2790100.0),
    "ss_quantity" -> (2583643.0 / 2790100.0),
    "ss_wholesale_cost" -> (4961526.0 / 2790100.0),
    "ss_list_price" -> (5335727.0 / 2790100.0),
    "ss_sales_price" -> (5291366.0 / 2790100.0),
    "ss_ext_discount_amt" -> (4479492.0 / 2790100.0),
    "ss_ext_sales_price" -> (13883583.0 / 2790100.0),
    "ss_ext_wholesale_cost" -> (14096862.0 / 2790100.0),
    "ss_ext_list_price" -> (14427679.0 / 2790100.0),
    "ss_ext_tax" -> (6102393.0 / 2790100.0),
    "ss_coupon_amt" -> (4479492.0 / 2790100.0),
    "ss_net_paid" -> (13869302.0 / 2790100.0),
    "ss_net_paid_inc_tax" -> (14187449.0 / 2790100.0),
    "ss_net_profit" -> (13924016.0 / 2790100.0),
    "t_time_sk" -> (346780.0 / 86400.0),
    "t_time_id" -> (430322.0 / 86400.0),
    "t_time" -> (346780.0 / 86400.0),
    "t_hour" -> (390.0 / 86400.0),
    "t_minute" -> (1198.0 / 86400.0),
    "t_second" -> (3910.0 / 86400.0),
    "t_am_pm" -> (230.0 / 86400.0),
    "t_shift" -> (253.0 / 86400.0),
    "t_sub_shift" -> (270.0 / 86400.0),
    "t_meal_time" -> (18685.0 / 86400.0),
    "w_warehouse_sk" -> (63.0 / 5.0),
    "w_warehouse_id" -> (70.0 / 5.0),
    "w_warehouse_name" -> (99.0 / 5.0),
    "w_warehouse_sq_ft" -> (59.0 / 5.0),
    "w_street_number" -> (58.0 / 5.0),
    "w_street_name" -> (97.0 / 5.0),
    "w_street_type" -> (90.0 / 5.0),
    "w_suite_number" -> (67.0 / 5.0),
    "w_city" -> (64.0 / 5.0),
    "w_county" -> (75.0 / 5.0),
    "w_state" -> (60.0 / 5.0),
    "w_zip" -> (63.0 / 5.0),
    "w_country" -> (71.0 / 5.0),
    "w_gmt_offset" -> (62.0 / 5.0),
    "wp_web_page_sk" -> (363.0 / 60.0),
    "wp_web_page_id" -> (267.0 / 60.0),
    "wp_rec_start_date" -> (118.0 / 60.0),
    "wp_rec_end_date" -> (108.0 / 60.0),
    "wp_creation_date_sk" -> (133.0 / 60.0),
    "wp_access_date_sk" -> (232.0 / 60.0),
    "wp_autogen_flag" -> (74.0 / 60.0),
    "wp_customer_sk" -> (115.0 / 60.0),
    "wp_url" -> (77.0 / 60.0),
    "wp_type" -> (153.0 / 60.0),
    "wp_char_count" -> (314.0 / 60.0),
    "wp_link_count" -> (191.0 / 60.0),
    "wp_image_count" -> (116.0 / 60.0),
    "wp_max_ad_count" -> (106.0 / 60.0),
    "wr_returned_date_sk" -> (115662.0 / 71937.0),
    "wr_returned_time_sk" -> (307916.0 / 71937.0),
    "wr_item_sk" -> (199023.0 / 71937.0),
    "wr_refunded_customer_sk" -> (314261.0 / 71937.0),
    "wr_refunded_cdemo_sk" -> (347612.0 / 71937.0),
    "wr_refunded_hdemo_sk" -> (147010.0 / 71937.0),
    "wr_refunded_addr_sk" -> (296226.0 / 71937.0),
    "wr_returning_customer_sk" -> (314535.0 / 71937.0),
    "wr_returning_cdemo_sk" -> (347587.0 / 71937.0),
    "wr_returning_hdemo_sk" -> (147065.0 / 71937.0),
    "wr_returning_addr_sk" -> (296474.0 / 71937.0),
    "wr_web_page_sk" -> (58351.0 / 71937.0),
    "wr_reason_sk" -> (58299.0 / 71937.0),
    "wr_order_number" -> (303855.0 / 71937.0),
    "wr_return_quantity" -> (67129.0 / 71937.0),
    "wr_return_amt" -> (352262.0 / 71937.0),
    "wr_return_tax" -> (218578.0 / 71937.0),
    "wr_return_amt_inc_tax" -> (360320.0 / 71937.0),
    "wr_fee" -> (173452.0 / 71937.0),
    "wr_return_ship_cost" -> (343195.0 / 71937.0),
    "wr_refunded_cash" -> (349104.0 / 71937.0),
    "wr_reversed_charge" -> (304966.0 / 71937.0),
    "wr_account_credit" -> (303016.0 / 71937.0),
    "wr_net_loss" -> (350651.0 / 71937.0),
    "ws_sold_date_sk" -> (190309.0 / 720791.0),
    "ws_sold_time_sk" -> (366281.0 / 720791.0),
    "ws_ship_date_sk" -> (1002770.0 / 720791.0),
    "ws_item_sk" -> (1422173.0 / 720791.0),
    "ws_bill_customer_sk" -> (387027.0 / 720791.0),
    "ws_bill_cdemo_sk" -> (477267.0 / 720791.0),
    "ws_bill_hdemo_sk" -> (212053.0 / 720791.0),
    "ws_bill_addr_sk" -> (332610.0 / 720791.0),
    "ws_ship_customer_sk" -> (387045.0 / 720791.0),
    "ws_ship_cdemo_sk" -> (476889.0 / 720791.0),
    "ws_ship_hdemo_sk" -> (211975.0 / 720791.0),
    "ws_ship_addr_sk" -> (333358.0 / 720791.0),
    "ws_web_page_sk" -> (544723.0 / 720791.0),
    "ws_web_site_sk" -> (454579.0 / 720791.0),
    "ws_ship_mode_sk" -> (454418.0 / 720791.0),
    "ws_warehouse_sk" -> (274179.0 / 720791.0),
    "ws_promo_sk" -> (815999.0 / 720791.0),
    "ws_order_number" -> (422321.0 / 720791.0),
    "ws_quantity" -> (635008.0 / 720791.0),
    "ws_wholesale_cost" -> (1311730.0 / 720791.0),
    "ws_list_price" -> (1490143.0 / 720791.0),
    "ws_sales_price" -> (1463291.0 / 720791.0),
    "ws_ext_discount_amt" -> (3743518.0 / 720791.0),
    "ws_ext_sales_price" -> (3744230.0 / 720791.0),
    "ws_ext_wholesale_cost" -> (3749083.0 / 720791.0),
    "ws_ext_list_price" -> (3899958.0 / 720791.0),
    "ws_ext_tax" -> (1774540.0 / 720791.0),
    "ws_coupon_amt" -> (1201276.0 / 720791.0),
    "ws_ext_ship_cost" -> (3606549.0 / 720791.0),
    "ws_net_paid" -> (3738132.0 / 720791.0),
    "ws_net_paid_inc_tax" -> (3831308.0 / 720791.0),
    "ws_net_paid_inc_ship" -> (3836412.0 / 720791.0),
    "ws_net_paid_inc_ship_tax" -> (3935107.0 / 720791.0),
    "ws_net_profit" -> (3725460.0 / 720791.0),
    "web_site_sk" -> (241.0 / 30.0),
    "web_site_id" -> (163.0 / 30.0),
    "web_rec_start_date" -> (108.0 / 30.0),
    "web_rec_end_date" -> (100.0 / 30.0),
    "web_name" -> (99.0 / 30.0),
    "web_open_date_sk" -> (144.0 / 30.0),
    "web_close_date_sk" -> (128.0 / 30.0),
    "web_class" -> (65.0 / 30.0),
    "web_manager" -> (385.0 / 30.0),
    "web_mkt_id" -> (100.0 / 30.0),
    "web_mkt_class" -> (945.0 / 30.0),
    "web_mkt_desc" -> (1503.0 / 30.0),
    "web_market_manager" -> (463.0 / 30.0),
    "web_company_id" -> (99.0 / 30.0),
    "web_company_name" -> (113.0 / 30.0),
    "web_street_number" -> (201.0 / 30.0),
    "web_street_name" -> (377.0 / 30.0),
    "web_street_type" -> (207.0 / 30.0),
    "web_suite_number" -> (208.0 / 30.0),
    "web_city" -> (80.0 / 30.0),
    "web_county" -> (75.0 / 30.0),
    "web_state" -> (60.0 / 30.0),
    "web_zip" -> (76.0 / 30.0),
    "web_country" -> (71.0 / 30.0),
    "web_gmt_offset" -> (62.0 / 30.0),
    "web_tax_percentage" -> (147.0 / 30.0))
}
